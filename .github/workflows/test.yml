name: Skylens
on:
   push:
        branches: [ master, dask ]

jobs:
     build:
          runs-on: ubuntu-latest
          steps:
             - uses: actions/checkout@v2
             - name: Set up Python 3.8
               uses: actions/setup-python@v2
               with:
                        python-version: '3.8'

             - name: Cache pip
               uses: actions/cache@v2
               with:
                     path: ~/.cache/pip
                     key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
                     restore-keys: |
                               ${{ runner.os }}-pip-
                               ${{ runner.os }}-

             - name: Install dependencies	
               run: |
                        pip install -r requirements.txt
                        python -m pip install "dask[bag]" --upgrade
                        python -m pip install 'fsspec>=0.3.3'
                        pip install .
             - name: Tests
               run: |
                        python ./tests/test_pseudo_cl_0.py
                        python ./tests/test_pseudo_xi_0.py
